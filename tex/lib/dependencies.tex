\usepackage[dvipsnames,table,xcdraw]{xcolor}
\usepackage[pdftex]{graphicx}
\usepackage[export]{adjustbox}
% \usepackage[noEnd=true,commentColor=black]{algpseudocodex}
\usepackage{algorithm}
\usepackage{algorithmicx,algpseudocode}
\usepackage{amsmath,amssymb,amsthm,amsfonts}
\usepackage{annotate-equations}
\usepackage{authblk}
\usepackage{array}
\usepackage{bibunits}
\usepackage{bold-extra}
\usepackage{booktabs}
\usepackage{cancel}
\usepackage{caption}
\usepackage{circledsteps}
\usepackage{cite}
\usepackage{colortbl}
\usepackage{csvsimple}
\usepackage{etoolbox}
\usepackage[T1]{fontenc}
\usepackage{float}
\usepackage[margin=1in]{geometry}
\usepackage{glossaries,glossaries-extra}
\usepackage[hypertexnames=false]{hyperref}
\usepackage{cleveref}
\usepackage{ifthen}
\usepackage{import}
% \usepackage[inline]{enumitem}
\usepackage{listings}
\usepackage{longtable}
\usepackage{makecell}
\usepackage{makecmds}
\usepackage{mathtools}
\usepackage{multirow}
\usepackage{natbib}
\usepackage{orcidlink}
\usepackage{physics}
\usepackage[section]{placeins}
\usepackage{pythonhighlight}
\usepackage{rotating}
\usepackage[subtle]{savetrees}
\usepackage[mark=***]{sectionbreak}
\usepackage{setspace}
\usepackage{siunitx}
\usepackage{stix}
\usepackage{stmaryrd}
\usepackage{stringstrings}
\usepackage{subcaption}
\usepackage{tabularx}
\usepackage{textcomp}
\usepackage{tikz}
\usetikzlibrary{arrows.meta}
\usepackage[most]{tcolorbox}
\usepackage{vcell}
\usepackage{xfp}
\usepackage{xparse}
\usepackage{xstring}
\usepackage{empheq}

% Color definitions
\definecolor{seabornBrown}{RGB}{134, 86, 75}
\definecolor{seabornPink}{RGB}{255, 119, 193}
\definecolor{seabornPinkDark}{RGB}{152, 34, 116}
\definecolor{darkred}{HTML}{E32B60}
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

% Custom commands and environments
\newcolumntype{Y}{>{\centering\arraybackslash}X}

\DeclareRobustCommand{\rchi}{{\mathpalette\irchi\relax}}
\newcommand{\irchi}[2]{\raisebox{\depth}{$#1\chi$}}

\newtcolorbox{mybox}{
  enhanced,
  boxrule=0pt,frame hidden,
  borderline west={4pt}{0pt}{green!50!black},
  colback=green!30!gray!15,
  sharp corners,
  parbox=false
}

\makeatletter
\def\mathcolor#1#{\@mathcolor{#1}}
\def\@mathcolor#1#2#3{%
  \protect\leavevmode
  \begingroup\color#1{#2}#3\endgroup
}
\makeatother

\newcommand{\adjustedaccent}[1]{%
  \mathchoice{}{}
    {\mbox{\raisebox{-.75ex}[0pt][0pt]{$\scriptscriptstyle#1$}}}
    {\mbox{\raisebox{-.55ex}[0pt][0pt]{\scalebox{.8}{$\scriptscriptstyle#1$}}}}
}
\newcommand\smileacc[1]{\overset{\adjustedaccent{\smile}}{#1}}
\newcommand\frownacc[1]{\overset{\adjustedaccent{\smallfrown}}{#1}}

\makeatletter
\DeclareRobustCommand{\ctau}{{% capital tau
  \mathpalette\cap@greek\tau
}}
\DeclareRobustCommand{\csigma}{{% capital sigma
  \mathpalette\cap@greek\sigma
}}
\newcommand{\cap@greek}[2]{%
  \begingroup
  \sbox\z@{$#1t$}%
  \resizebox{!}{\ht\z@}{$\m@th#1#2$}%
  \endgroup
}
\makeatother

% More custom commands (color-related, math symbols, etc.)
\newcommand{\colort}{\mathcolor{VioletRed}{\mathrm{t}}}
\newcommand{\colortsetofT}{\lBrace \colort \rBrace}
\newcommand{\colortsetofTone}{\lBrace \colort + 1 \rBrace}
\newcommand{\colortau}{\mathcolor{orange}{\ctau}}
\newcommand{\colortausetoft}{\lBrace \colortau \rBrace}
\newcommand{\colortausetofT}{\{\hspace{-0.5ex}\lBrace \colortau \rBrace\hspace{-0.5ex}\}}
\newcommand{\colorT}{\mathcolor{red}{T}}
\newcommand{\colorTbar}{\mathcolor{red}{\smash{\smileacc{T}}}}
\newcommand{\colork}{\mathcolor{purple}{k}}
\newcommand{\colors}{\mathcolor{blue}{\hat{\mathrm{s}}}}
\newcommand{\colorS}{\mathcolor{blue}{S}}
\newcommand{\colorK}{\mathcolor{purple}{\mathrm{K}}}
\newcommand{\colorh}{\mathcolor{violet}{h}}
\newcommand{\colorH}{\mathcolor{violet}{\mathrm{H}}}
\newcommand{\colorHcal}{\mathcolor{violet}{\mathcal{H}}}
\newcommand{\colorL}{\mathcolor{purple}{\mathrm{L}}}
\newcommand{\colorD}{\mathcolor{blue}{{D}}}
\newcommand{\colorB}{\mathcolor{olive}{\mathcal{B}}}
\newcommand{\colorBnot}{\mathcolor{olive}{\cancel{\mathcal{B}}}}
\newcommand{\colorg}{\mathcolor{teal}{g}}
\newcommand{\colorG}{\mathcolor{teal}{G}}

\let\mycheckmark\checkmark
\renewcommand{\checkmark}{\textcolor{ForestGreen}{\mycheckmark}}

\newcommand{\nullval}{\texttt{null}}

% Theorem-like environments
\theoremstyle{definition}
\newtheorem{proofpart}{Part}
% \newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}{Lemma}[section]
\newtheorem{sublemma}{Sublemma}[lemma]
\newtheorem{corollary}{Corollary}[lemma]
\makeatletter
\@addtoreset{proofpart}{theorem}
\@addtoreset{proofpart}{lemma}
\@addtoreset{proofpart}{corollary}
\makeatother

\hypersetup{breaklinks=true}

\renewcommand{\eqnhighlightheight}{\mathstrut}

% Colorboxed command
\newcommand*{\colorboxed}{}
\def\colorboxed#1#{%
  \colorboxedAux{#1}%
}
\newcommand*{\colorboxedAux}[3]{%
  \begingroup
    \setlength\fboxrule{1pt}
    \colorlet{cb@saved}{.}%
    \color#1{#2}%
    \boxed{%
      \color{cb@saved}%
      #3%
    }%
  \endgroup
}

\makeatletter
\renewcommand{\boxed}[1]{\text{\fboxsep=.2em\fbox{\m@th$\displaystyle#1$}}}
\makeatother

\renewcommand{\stackrel}[2]{%
  \mathrel{\smash{\vbox{\offinterlineskip\ialign{%
    \hfil##\hfil\cr
    $\scriptscriptstyle#1$\cr
    $#2$\cr
}}}}}

\newcommand{\hv}{h.v.\hphantom{}}
\newcommand{\twodots}{\mathinner {\ldotp \ldotp}}

% Algorithm-related commands
% \let\mythealgorithm\thealgorithm

% \makeatletter
% \newlength{\comment@width}

% \renewcommand{\Comment}[1]{%
%   \sbox0{#1}%
%   \ifdim\wd0>\comment@width
%     \setlength{\comment@width}{\wd0}%
%   \fi
%   \ifcsname comment@\arabic{algorithm}@width\endcsname
%     \algorithmiccomment{\makebox[\csname comment@\mythealgorithm @width\endcsname][l]{#1}}%
%   \else
%     \algorithmiccomment{#1}%
%   \fi
% }
% \AtBeginEnvironment{algorithmic}{\setlength{\comment@width}{0pt}}
% \AtEndEnvironment{algorithmic}{%
%   \immediate\write\@auxout{%
%     \string\algcommentwidth{\mythealgorithm}{\the\comment@width}%
%   }%
% }
% \newcommand{\algcommentwidth}[2]{%
%   \global\@namedef{comment@#1@width}{#2}%
% }
% \makeatother

\MakeRobust{\Call}
\makeatletter
\def\algbackskip{\hskip-\ALG@thistlm}
\makeatother

% Python code environment
\lstnewenvironment{mypython}[1][]{\lstset{style=mypython,#1}}{}

% Inline code command
\newcommand{\code}[1]{\mbox{%
    \ttfamily
    \color{darkred}
    \tcbox[
        on line,
        boxsep=0pt, left=4pt, right=4pt, top=2pt, bottom=1.5pt,
        toprule=0pt, rightrule=0pt, bottomrule=0pt, leftrule=0pt,
        oversize=0pt, enlarge left by=0pt, enlarge right by=0pt,
        colframe=white, colback=black!12,
        height=.8\baselineskip
    ]{\color{darkred}\detokenize{#1}}%
}}

% Listing style
\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,
    breaklines=true,
    captionpos=t,
    keepspaces=true,
    numbers=left,
    numbersep=5pt,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=2
}

\lstset{style=pythonhighlight-style}

\DeclareCaptionFormat{listing}{\rule{\dimexpr\textwidth\relax}{0.4pt}\par\vskip1pt#1#2#3\par\vspace{-5pt}\rule{\dimexpr\textwidth\relax}{0.4pt}}
\captionsetup[lstlisting]{format=listing,singlelinecheck=false, margin=0pt, ,labelsep=space,labelfont=bf}

% Additional commands from the second preamble
\newcommand*\Let[2]{\State #1 $\gets$ #2}
\renewcommand{\algorithmicrequire}{\textbf{Input:}}
\renewcommand{\algorithmicensure}{\textbf{Output:}}
\newcommand{\ceil}[1]{\left\lceil #1 \right\rceil}
