\subsection{Recency-proportional Resolution (RPR) Policy Algorithm}
\label{sec:recency-proportional-resolution-algo}

This stratum retention algorithm's retained stratum size complexity and inferential resolution falls between the fixed and depth-proportional resolution algorithms, covered in the immediately preceding sections.

Recall that the depth-proportional resolution algorithm introduces gaps between retained strata in the historical record that grow in linear proportion to the length of the historical record.
In contrast, the fixed resolution algorithm's absolute inferential resolution eponymously remains constant in perpetuity.
No point in the historical record exhibits a gap in retained strata larger than a fixed threshold.

The recency-proportional resolution algorithm bounds gap width in the historical record to a constant factor of its antiquity --- its number of time steps back from the most contemporary entry.
More exactly, if $n$ time steps have elapsed in total, then at any time point $m \in [0, n]$ at $k = n - m$ time steps back from the contemporary time point no gap in the historical record will exceed width of
\begin{align}
  \left\lfloor \frac{k}{r} \right\rfloor.
  \label{eqn:rpr-gap}
\end{align}
So, inferential uncertainty at each individual time point grows linearly with time.
Put another way, looking back from the contemporary end of the historical record, inferential uncertainty grows linearly with antiquity.
Uncertainty associated with sites any fixed number $k$ of time points behind the contemporary, however, remains constant in perpetuity.

We will show retained strata count growing as $O(r\log{n})$ under the recency-proportional resolution retention algorithm.

%TODO should this be inline?
Algorithm Listing \ref{alg:recency-proportional-resolution-algo-enum-retained-ranks} specifies the sets of strata called for to comprise the historical record at each time point under the recency-proportional resolution retention algorithm.
This set is determined iteratively, beginning at time point zero --- which is always called for inclusion.
From Equation \ref{eqn:rpr-gap}, the gap to the next included stratum can be at most $n/r$ sites, where $n$ is the contemporary time point.
Although selecting the $\lfloor n/r \rfloor$ time point for inclusion would satisfy inferential resolution guarantees, a slight complication is necessary to ensure sole selection of strata also retained at earlier time points.
A fuller rationale will follow, but instead the time point forward the greatest binary power less than or equal to $n/r$ is chosen for inclusion in the historical record,
\begin{align*}
  2^{\lfloor \log_{2}\left(\frac{n}{r}\right) \rfloor}.
\end{align*}
The next iteration repeats the procedure, but stepping off from the time point newly selected for inclusion instead of time point zero.
Iteration continues until reaching the contemporary time point.

The set of strata to eliminate can be calculated from set subtraction between enumerations of the historical record at time points $t-1$ and $t$.
So, time complexity to update follows from the time complexity of the record enumeration algorithm above.
% TODO can this be made to $O(1)$?
Time complexity turns out to be $O(\log n)$, detailed in Theorem \ref{thm:recency-proportional-resolution-algo-uncertainty-bound}.
Space complexity $O(\log n)$ of the retained historical record also follows closely from the record enumeration algorithm, shown in Theorem \ref{thm:recency-proportional-resolution-algo-enum-retained-ranks}.

% todo this needs a big refinement
Why does flooring step sizes to a binary power ensure self-consistency?
First, note that the step size provided at any particular point in the historical record over successive time points is strictly nondecreasing.
Because step size occurs in binary powers of 2, all multiples of the current step size at or before the contemporary time point will be contained in the historical record.
Second, note that step size over the historical record at any particular timepoint is strictly nonincreasing.
Due to the binary flooring procedure, when step size at a point in the historical record increases, it will double (or quadruple, octuple, etc.).
The new step endpoint is guaranteed available because it is a multiple of the original step size.
Theorem \ref{thm:recency-proportional-resolution-algo-self-consistency} uses inductive proof-by-contradiction to show this point.


\input{alg/recency-proportional-resolution-algo-gen-drop-ranks.tex}
\input{alg/recency-proportional-resolution-algo-pred-keep-rank.tex}
\input{alg/recency-proportional-resolution-algo-enum-retained-ranks.tex}

\input{thm/recency-proportional-resolution-algo-self-consistency.tex}
\input{thm/recency-proportional-resolution-algo-space-complexity.tex}
\input{thm/recency-proportional-resolution-algo-uncertainty-bound.tex}
